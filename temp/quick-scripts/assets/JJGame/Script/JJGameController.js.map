{"version":3,"sources":["JJGameController.js"],"names":["cc","Class","extends","Component","properties","mapLayer","default","type","Node","uiLayer","onLoad","Atom","gameState","setGameStop","eventMgr","listen","obj","data","onStartGame","onGameOver","onPause","onReStart","start","addTouchEvent","onDestroy","unListenByObj","console","log","minterval","gameUpdateInterval","gameConfMgr","getInfo","gameSpeed","maxSteps","indexOffset","gameDataMgr","setData","topbar","prefabMgr","getPrefabObj","parent","topbar_delegate","getComponent","addBrick","playReadGo","setGameStart","controltips","controltips_delegate","self","node","on","EventType","TOUCH_START","event","isGameIng","posi","touch","_point","width","getData","brickNum","turnSpeed","minx","maxx","action","x","player","moveTo","p","y","runAction","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","stopAllActions","_type","over_ui","zIndex","removeAllChildren","removeFromParent","_bool","pause_ui","setGamePause","setGameIng","indexTag","player_indexTag","mapController","i","bricklist","makeBrickNodes","j","length","height","name","Math","ceil","update","dt","mapUpdate","score","notify","hitCheck","isGameStart","mUpdate"],"mappings":"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","file":"JJGameController.js","sourceRoot":"../../../../../assets/JJGame/Script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //地图层\n        mapLayer:{\n            default:null,\n            type:cc.Node,\n        },\n        uiLayer:{\n            default:null,\n            type:cc.Node,\n        },\n    },\n\n    onLoad () {\n        cc.Atom.gameState.setGameStop();\n        cc.Atom.eventMgr.listen(\"onStartGame\", (obj,data)=>{ this.onStartGame()     }, this);\n        cc.Atom.eventMgr.listen(\"onGameOver\" , (obj,data)=>{ this.onGameOver(data)  }, this);\n        cc.Atom.eventMgr.listen(\"onPause\"    , (obj,data)=>{ this.onPause(data)     }, this);\n        cc.Atom.eventMgr.listen(\"onReStart\"  , (obj,data)=>{ this.onReStart(data)   }, this);\n    },\n\n    start () {    \n        this.addTouchEvent()\n    },\n\n    onDestroy(){\n        cc.Atom.eventMgr.unListenByObj(this)\n    },\n\n    onStartGame(){\n        console.log(\">>>> onStartGame \")\n        this.minterval = 0;\n        this.gameUpdateInterval = cc.Atom.gameConfMgr.getInfo(\"gameUpdateInterval\");\n        this.gameSpeed = cc.Atom.gameConfMgr.getInfo(\"gameSpeed\"); //节奏提速\n        this.maxSteps = cc.Atom.gameConfMgr.getInfo(\"maxSteps\");   //最大层数\n        this.indexOffset = cc.Atom.gameConfMgr.getInfo(\"indexOffset\");//阶的偏移index\n\n        cc.Atom.gameDataMgr.setData(\"mSaveStart\",0)\n        //add top bar\n        var topbar = cc.Atom.prefabMgr.getPrefabObj(\"topStatuBar\");\n        topbar.parent = this.uiLayer;\n        this.topbar = topbar;\n        this.topbar_delegate = this.topbar.getComponent(\"topBarDelegate\")\n\n        this.addBrick();\n        //play ready go\n        this.playReadGo();\n        cc.Atom.gameState.setGameStart()\n    },\n\n    playReadGo(){\n        var controltips = cc.Atom.prefabMgr.getPrefabObj(\"controltips\");\n        controltips.parent = this.uiLayer;\n        this.controltips = controltips;\n        this.controltips_delegate = this.controltips.getComponent(\"controltipsDelegate\")\n    },\n\n    addTouchEvent(){\n        var self = this\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\n            console.log(\">>>>>> TOUCH_START\");\n            if(!cc.Atom.gameState.isGameIng()){\n                return\n            }\n\n            var posi = event.touch._point\n            //边界\n            var width = cc.Atom.gameDataMgr.getData(\"brickWidth\");\n            var brickNum = cc.Atom.gameConfMgr.getInfo(\"brickNum\");\n            var turnSpeed  = cc.Atom.gameConfMgr.getInfo(\"turnSpeed\");\n            var minx = (1 - ( brickNum +1) /2) * width;\n            var maxx = (brickNum - ( brickNum +1) /2) * width;\n\n            var action;\n            if(posi.x < self.node.width /2){\n                var x = self.player.x -width;\n                if(x < minx){\n                    x = minx;\n                }\n                action = cc.moveTo(turnSpeed, cc.p(x , self.player.y));\n            }else{\n                var x = self.player.x +width;\n                if(x > maxx){\n                    x = maxx;\n                }\n                action = cc.moveTo(turnSpeed, cc.p(x , self.player.y));\n            }\n            self.player.runAction(action);\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            console.log(\">>>>>> TOUCH_MOVE\");\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\n            console.log(\">>>>>> TOUCH_END\");\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\n            console.log(\">>>>>> TOUCH_CANCEL\");\n        })\n    },\n\n    onGameOver(data){\n        this.player.stopAllActions();\n        //\n        console.log(\">>> player over\");\n        if(data){\n            var _type = data._type\n\n        }\n        var over_ui = cc.Atom.prefabMgr.getPrefabObj(\"over_ui\");\n        over_ui.parent = this.uiLayer\n        over_ui.zIndex = 150\n    },\n\n    onReStart(){\n        cc.Atom.gameState.setGameStop()\n        this.mapLayer.removeAllChildren()\n        this.topbar.removeFromParent()\n        this.onStartGame();\n    },\n\n    onPause(_bool){\n        if(_bool == true){\n            console.log(\">>> show pause_ui \")\n            var pause_ui = cc.Atom.prefabMgr.getPrefabObj(\"paruse_ui\");\n            pause_ui.parent = this.uiLayer\n            pause_ui.zIndex = 150\n            cc.Atom.gameState.setGamePause()\n        }else{\n            cc.Atom.gameState.setGameIng()\n        }\n        \n    },\n\n    addBrick(){\n        this.indexTag = 0; //砖块的位置\n        this.player_indexTag = 0;\n        this.minterval = 0;\n\n        this.mapController = this.mapLayer.getComponent('MapController');\n        //创建基础地图\n        for (var i = 1; i <= this.maxSteps/this.indexOffset; i++) {\n            var bricklist = this.mapController.makeBrickNodes(i)\n            for (var j = 0; j < bricklist.length; j++) {\n                var node = bricklist[j];\n                if(node){\n                    var width  = node.width;\n                    var height = node.height;\n                    var x = (j+1 - ( bricklist.length +1) /2) * width ;\n                    var y = i  * height - height/2;\n                    node.parent = this.mapLayer;\n                    node.x = x;\n                    node.y = y;\n\n                    cc.Atom.gameDataMgr.setData(\"brickWidth\" , width)\n                    cc.Atom.gameDataMgr.setData(\"brickHeight\", height)\n                }\n            }\n        }\n\n        //添加obj\n        var player = cc.Atom.prefabMgr.getPrefabObj(\"player_obj\"); //创建一个砖块 prefab节点\n        player.name   = \"player\"; \n        player.parent = this.mapLayer;\n        player.y = player.height/2 + player.height*3;\n        player.zIndex  = 100\n        this.player = player;\n\n        this.player_indexTag = Math.ceil(cc.Atom.gameConfMgr.getInfo(\"brickNum\")/2);\n        cc.Atom.gameDataMgr.setData(\"isPlayerMove\" , true);\n    },\n\n    update (dt) {\n        if(cc.Atom.gameState.isGameIng()){\n            this.minterval += dt;\n            if(this.minterval >= cc.Atom.gameConfMgr.getInfo(\"jumpInterval\")){\n                console.log(\">>>> update position >>> \")\n                this.minterval = 0;\n                this.mapController.mapUpdate(this.mapLayer , dt);\n                \n                var score = dt *1000\n                cc.Atom.eventMgr.notify(\"onAddScore\" , score);\n                // this.topbar_delegate.mUpdate(dt);\n            }\n            this.mapController.hitCheck(this.mapLayer);\n             \n        }else if(cc.Atom.gameState.isGameStart()){\n            this.controltips_delegate.mUpdate(dt);\n        }\n    },\n});\n"]}