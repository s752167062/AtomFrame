{"version":3,"sources":["../../../../../assets/JJGame/Script/assets/JJGame/Script/JJGameController.js"],"names":["cc","Class","extends","Component","properties","mapLayer","default","type","Node","uiLayer","onLoad","Atom","gameState","setGameStop","eventMgr","listen","obj","data","onStartGame","onGameOver","onPause","onReStart","start","addTouchEvent","onDestroy","unListenByObj","console","log","gameUpdateInterval","gameConfMgr","getInfo","gameSpeed","maxSteps","indexOffset","topbar","prefabMgr","getPrefabObj","parent","node","addBrick","setGameIng","self","on","EventType","TOUCH_START","event","isGameIng","posi","touch","_point","width","gameDataMgr","getData","brickNum","turnSpeed","minx","maxx","action","x","player","moveTo","p","y","runAction","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","stopAllActions","_type","removeAllChildren","removeFromParent","_bool","pause_ui","zIndex","setGamePause","indexTag","player_indexTag","minterval","mapController","getComponent","i","bricklist","makeBrickNodes","j","length","height","setData","name","Math","ceil","update","dt","mapUpdate"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACAC,kBAAS;AACLC,qBAAQ,IADH;AAELC,kBAAKP,GAAGQ;AAFH,SAFD;AAMRC,iBAAQ;AACJH,qBAAQ,IADJ;AAEJC,kBAAKP,GAAGQ;AAFJ;AANA,KAHP;;AAeLE,UAfK,oBAeK;AAAA;;AACNV,WAAGW,IAAH,CAAQC,SAAR,CAAkBC,WAAlB;AACAb,WAAGW,IAAH,CAAQG,QAAR,CAAiBC,MAAjB,CAAwB,aAAxB,EAAuC,UAACC,GAAD,EAAKC,IAAL,EAAY;AAAE,kBAAKC,WAAL;AAAwB,SAA7E,EAA+E,IAA/E;AACAlB,WAAGW,IAAH,CAAQG,QAAR,CAAiBC,MAAjB,CAAwB,YAAxB,EAAuC,UAACC,GAAD,EAAKC,IAAL,EAAY;AAAE,kBAAKE,UAAL,CAAgBF,IAAhB;AAAwB,SAA7E,EAA+E,IAA/E;AACAjB,WAAGW,IAAH,CAAQG,QAAR,CAAiBC,MAAjB,CAAwB,SAAxB,EAAuC,UAACC,GAAD,EAAKC,IAAL,EAAY;AAAE,kBAAKG,OAAL,CAAaH,IAAb;AAAwB,SAA7E,EAA+E,IAA/E;AACAjB,WAAGW,IAAH,CAAQG,QAAR,CAAiBC,MAAjB,CAAwB,WAAxB,EAAuC,UAACC,GAAD,EAAKC,IAAL,EAAY;AAAE,kBAAKI,SAAL,CAAeJ,IAAf;AAAwB,SAA7E,EAA+E,IAA/E;AACH,KArBI;AAuBLK,SAvBK,mBAuBI;AACL,aAAKC,aAAL;AACH,KAzBI;AA2BLC,aA3BK,uBA2BM;AACPxB,WAAGW,IAAH,CAAQG,QAAR,CAAiBW,aAAjB,CAA+B,IAA/B;AACH,KA7BI;AA+BLP,eA/BK,yBA+BQ;AACTQ,gBAAQC,GAAR,CAAY,mBAAZ;AACA,aAAKC,kBAAL,GAA0B5B,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,oBAA5B,CAA1B;AACA,aAAKC,SAAL,GAAiB/B,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,WAA5B,CAAjB,CAHS,CAGkD;AAC3D,aAAKE,QAAL,GAAgBhC,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,UAA5B,CAAhB,CAJS,CAIkD;AAC3D,aAAKG,WAAL,GAAmBjC,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,aAA5B,CAAnB,CALS,CAKqD;;AAE9D;AACA,YAAII,SAASlC,GAAGW,IAAH,CAAQwB,SAAR,CAAkBC,YAAlB,CAA+B,aAA/B,CAAb;AACAF,eAAOG,MAAP,GAAgB,KAAKC,IAArB;AACA,aAAKJ,MAAL,GAAcA,MAAd;;AAEA,aAAKK,QAAL;AACA;AACAvC,WAAGW,IAAH,CAAQC,SAAR,CAAkB4B,UAAlB;AACH,KA9CI;AAgDLjB,iBAhDK,2BAgDU;AACX,YAAIkB,OAAO,IAAX;AACA,aAAKH,IAAL,CAAUI,EAAV,CAAa1C,GAAGQ,IAAH,CAAQmC,SAAR,CAAkBC,WAA/B,EAA4C,UAAUC,KAAV,EAAiB;AACzDnB,oBAAQC,GAAR,CAAY,oBAAZ;AACA,gBAAG,CAAC3B,GAAGW,IAAH,CAAQC,SAAR,CAAkBkC,SAAlB,EAAJ,EAAkC;AAC9B;AACH;;AAED,gBAAIC,OAAOF,MAAMG,KAAN,CAAYC,MAAvB;AACA;AACA,gBAAIC,QAAQlD,GAAGW,IAAH,CAAQwC,WAAR,CAAoBC,OAApB,CAA4B,YAA5B,CAAZ;AACA,gBAAIC,WAAWrD,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,UAA5B,CAAf;AACA,gBAAIwB,YAAatD,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,WAA5B,CAAjB;AACA,gBAAIyB,OAAO,CAAC,IAAI,CAAEF,WAAU,CAAZ,IAAgB,CAArB,IAA0BH,KAArC;AACA,gBAAIM,OAAO,CAACH,WAAW,CAAEA,WAAU,CAAZ,IAAgB,CAA5B,IAAiCH,KAA5C;;AAEA,gBAAIO,MAAJ;AACA,gBAAGV,KAAKW,CAAL,GAASjB,KAAKH,IAAL,CAAUY,KAAV,GAAiB,CAA7B,EAA+B;AAC3B,oBAAIQ,IAAIjB,KAAKkB,MAAL,CAAYD,CAAZ,GAAeR,KAAvB;AACA,oBAAGQ,IAAIH,IAAP,EAAY;AACRG,wBAAIH,IAAJ;AACH;AACDE,yBAASzD,GAAG4D,MAAH,CAAUN,SAAV,EAAqBtD,GAAG6D,CAAH,CAAKH,CAAL,EAASjB,KAAKkB,MAAL,CAAYG,CAArB,CAArB,CAAT;AACH,aAND,MAMK;AACD,oBAAIJ,IAAIjB,KAAKkB,MAAL,CAAYD,CAAZ,GAAeR,KAAvB;AACA,oBAAGQ,IAAIF,IAAP,EAAY;AACRE,wBAAIF,IAAJ;AACH;AACDC,yBAASzD,GAAG4D,MAAH,CAAUN,SAAV,EAAqBtD,GAAG6D,CAAH,CAAKH,CAAL,EAASjB,KAAKkB,MAAL,CAAYG,CAArB,CAArB,CAAT;AACH;AACDrB,iBAAKkB,MAAL,CAAYI,SAAZ,CAAsBN,MAAtB;AACH,SA7BD;;AA+BA,aAAKnB,IAAL,CAAUI,EAAV,CAAa1C,GAAGQ,IAAH,CAAQmC,SAAR,CAAkBqB,UAA/B,EAA2C,UAAUnB,KAAV,EAAiB;AACxDnB,oBAAQC,GAAR,CAAY,mBAAZ;AACH,SAFD;;AAIA,aAAKW,IAAL,CAAUI,EAAV,CAAa1C,GAAGQ,IAAH,CAAQmC,SAAR,CAAkBsB,SAA/B,EAA0C,UAAUpB,KAAV,EAAiB;AACvDnB,oBAAQC,GAAR,CAAY,kBAAZ;AACH,SAFD;;AAIA,aAAKW,IAAL,CAAUI,EAAV,CAAa1C,GAAGQ,IAAH,CAAQmC,SAAR,CAAkBuB,YAA/B,EAA6C,UAAUrB,KAAV,EAAiB;AAC1DnB,oBAAQC,GAAR,CAAY,qBAAZ;AACH,SAFD;AAGH,KA5FI;AA8FLR,cA9FK,sBA8FMF,IA9FN,EA8FW;AACZ,aAAK0C,MAAL,CAAYQ,cAAZ;AACA;AACAzC,gBAAQC,GAAR,CAAY,iBAAZ;AACA,YAAGV,IAAH,EAAQ;AACJ,gBAAImD,QAAQnD,KAAKmD,KAAjB;AAEH;AACJ,KAtGI;AAwGL/C,aAxGK,uBAwGM;AACPrB,WAAGW,IAAH,CAAQC,SAAR,CAAkBC,WAAlB;AACA,aAAKR,QAAL,CAAcgE,iBAAd;AACA,aAAKnC,MAAL,CAAYoC,gBAAZ;AACA,aAAKpD,WAAL;AACH,KA7GI;AA+GLE,WA/GK,mBA+GGmD,KA/GH,EA+GS;AACV,YAAGA,SAAS,IAAZ,EAAiB;AACb7C,oBAAQC,GAAR,CAAY,oBAAZ;AACA,gBAAI6C,WAAWxE,GAAGW,IAAH,CAAQwB,SAAR,CAAkBC,YAAlB,CAA+B,WAA/B,CAAf;AACAoC,qBAASnC,MAAT,GAAkB,KAAK5B,OAAvB;AACA+D,qBAASC,MAAT,GAAkB,GAAlB;AACAzE,eAAGW,IAAH,CAAQC,SAAR,CAAkB8D,YAAlB;AACH,SAND,MAMK;AACD1E,eAAGW,IAAH,CAAQC,SAAR,CAAkB4B,UAAlB;AACH;AAEJ,KA1HI;AA4HLD,YA5HK,sBA4HK;AACN,aAAKoC,QAAL,GAAgB,CAAhB,CADM,CACa;AACnB,aAAKC,eAAL,GAAuB,CAAvB;AACA,aAAKC,SAAL,GAAiB,CAAjB;;AAEA,aAAKC,aAAL,GAAqB,KAAKzE,QAAL,CAAc0E,YAAd,CAA2B,eAA3B,CAArB;AACA;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,KAAK,KAAKhD,QAAL,GAAc,KAAKC,WAAxC,EAAqD+C,GAArD,EAA0D;AACtD,gBAAIC,YAAY,KAAKH,aAAL,CAAmBI,cAAnB,CAAkCF,CAAlC,CAAhB;AACA,iBAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAIF,UAAUG,MAA9B,EAAsCD,GAAtC,EAA2C;AACvC,oBAAI7C,OAAO2C,UAAUE,CAAV,CAAX;AACA,oBAAG7C,IAAH,EAAQ;AACJ,wBAAIY,QAASZ,KAAKY,KAAlB;AACA,wBAAImC,SAAS/C,KAAK+C,MAAlB;AACA,wBAAI3B,IAAI,CAACyB,IAAE,CAAF,GAAM,CAAEF,UAAUG,MAAV,GAAkB,CAApB,IAAwB,CAA/B,IAAoClC,KAA5C;AACA,wBAAIY,IAAIkB,IAAKK,MAAL,GAAcA,SAAO,CAA7B;AACA/C,yBAAKD,MAAL,GAAc,KAAKhC,QAAnB;AACAiC,yBAAKoB,CAAL,GAASA,CAAT;AACApB,yBAAKwB,CAAL,GAASA,CAAT;;AAEA9D,uBAAGW,IAAH,CAAQwC,WAAR,CAAoBmC,OAApB,CAA4B,YAA5B,EAA2CpC,KAA3C;AACAlD,uBAAGW,IAAH,CAAQwC,WAAR,CAAoBmC,OAApB,CAA4B,aAA5B,EAA2CD,MAA3C;AACH;AACJ;AACJ;;AAED;AACA,YAAI1B,SAAS3D,GAAGW,IAAH,CAAQwB,SAAR,CAAkBC,YAAlB,CAA+B,YAA/B,CAAb,CA3BM,CA2BqD;AAC3DuB,eAAO4B,IAAP,GAAgB,QAAhB;AACA5B,eAAOtB,MAAP,GAAgB,KAAKhC,QAArB;AACAsD,eAAOG,CAAP,GAAWH,OAAO0B,MAAP,GAAc,CAAd,GAAkB1B,OAAO0B,MAAP,GAAc,CAA3C;AACA1B,eAAOc,MAAP,GAAiB,GAAjB;AACA,aAAKd,MAAL,GAAcA,MAAd;;AAEA,aAAKiB,eAAL,GAAuBY,KAAKC,IAAL,CAAUzF,GAAGW,IAAH,CAAQkB,WAAR,CAAoBC,OAApB,CAA4B,UAA5B,IAAwC,CAAlD,CAAvB;AACA9B,WAAGW,IAAH,CAAQwC,WAAR,CAAoBmC,OAApB,CAA4B,cAA5B,EAA6C,IAA7C;AACH,KAhKI;AAkKLI,UAlKK,kBAkKGC,EAlKH,EAkKO;AACR,YAAG3F,GAAGW,IAAH,CAAQC,SAAR,CAAkBkC,SAAlB,EAAH,EAAiC;AAC7B,iBAAKgC,aAAL,CAAmBc,SAAnB,CAA6B,KAAKvF,QAAlC,EAA6CsF,EAA7C;AACH;AACJ;AAtKI,CAAT","file":"JJGameController.js","sourceRoot":"../../../../../assets/JJGame/Script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //地图层\n        mapLayer:{\n            default:null,\n            type:cc.Node,\n        },\n        uiLayer:{\n            default:null,\n            type:cc.Node,\n        },\n    },\n\n    onLoad () {\n        cc.Atom.gameState.setGameStop();\n        cc.Atom.eventMgr.listen(\"onStartGame\", (obj,data)=>{ this.onStartGame()     }, this);\n        cc.Atom.eventMgr.listen(\"onGameOver\" , (obj,data)=>{ this.onGameOver(data)  }, this);\n        cc.Atom.eventMgr.listen(\"onPause\"    , (obj,data)=>{ this.onPause(data)     }, this);\n        cc.Atom.eventMgr.listen(\"onReStart\"  , (obj,data)=>{ this.onReStart(data)   }, this);\n    },\n\n    start () {    \n        this.addTouchEvent()\n    },\n\n    onDestroy(){\n        cc.Atom.eventMgr.unListenByObj(this)\n    },\n\n    onStartGame(){\n        console.log(\">>>> onStartGame \")\n        this.gameUpdateInterval = cc.Atom.gameConfMgr.getInfo(\"gameUpdateInterval\");\n        this.gameSpeed = cc.Atom.gameConfMgr.getInfo(\"gameSpeed\"); //节奏提速\n        this.maxSteps = cc.Atom.gameConfMgr.getInfo(\"maxSteps\");   //最大层数\n        this.indexOffset = cc.Atom.gameConfMgr.getInfo(\"indexOffset\");//阶的偏移index\n\n        //add top bar\n        var topbar = cc.Atom.prefabMgr.getPrefabObj(\"topStatuBar\");\n        topbar.parent = this.node;\n        this.topbar = topbar;\n\n        this.addBrick();\n        //play ready go\n        cc.Atom.gameState.setGameIng()\n    },\n\n    addTouchEvent(){\n        var self = this\n        this.node.on(cc.Node.EventType.TOUCH_START, function (event) {\n            console.log(\">>>>>> TOUCH_START\");\n            if(!cc.Atom.gameState.isGameIng()){\n                return\n            }\n\n            var posi = event.touch._point\n            //边界\n            var width = cc.Atom.gameDataMgr.getData(\"brickWidth\");\n            var brickNum = cc.Atom.gameConfMgr.getInfo(\"brickNum\");\n            var turnSpeed  = cc.Atom.gameConfMgr.getInfo(\"turnSpeed\");\n            var minx = (1 - ( brickNum +1) /2) * width;\n            var maxx = (brickNum - ( brickNum +1) /2) * width;\n\n            var action;\n            if(posi.x < self.node.width /2){\n                var x = self.player.x -width;\n                if(x < minx){\n                    x = minx;\n                }\n                action = cc.moveTo(turnSpeed, cc.p(x , self.player.y));\n            }else{\n                var x = self.player.x +width;\n                if(x > maxx){\n                    x = maxx;\n                }\n                action = cc.moveTo(turnSpeed, cc.p(x , self.player.y));\n            }\n            self.player.runAction(action);\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            console.log(\">>>>>> TOUCH_MOVE\");\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_END, function (event) {\n            console.log(\">>>>>> TOUCH_END\");\n        })\n\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\n            console.log(\">>>>>> TOUCH_CANCEL\");\n        })\n    },\n\n    onGameOver(data){\n        this.player.stopAllActions();\n        //\n        console.log(\">>> player over\");\n        if(data){\n            var _type = data._type\n\n        }\n    },\n\n    onReStart(){\n        cc.Atom.gameState.setGameStop()\n        this.mapLayer.removeAllChildren()\n        this.topbar.removeFromParent()\n        this.onStartGame();\n    },\n\n    onPause(_bool){\n        if(_bool == true){\n            console.log(\">>> show pause_ui \")\n            var pause_ui = cc.Atom.prefabMgr.getPrefabObj(\"paruse_ui\");\n            pause_ui.parent = this.uiLayer\n            pause_ui.zIndex = 150\n            cc.Atom.gameState.setGamePause()\n        }else{\n            cc.Atom.gameState.setGameIng()\n        }\n        \n    },\n\n    addBrick(){\n        this.indexTag = 0; //砖块的位置\n        this.player_indexTag = 0;\n        this.minterval = 0;\n\n        this.mapController = this.mapLayer.getComponent('MapController');\n        //创建基础地图\n        for (var i = 1; i <= this.maxSteps/this.indexOffset; i++) {\n            var bricklist = this.mapController.makeBrickNodes(i)\n            for (var j = 0; j < bricklist.length; j++) {\n                var node = bricklist[j];\n                if(node){\n                    var width  = node.width;\n                    var height = node.height;\n                    var x = (j+1 - ( bricklist.length +1) /2) * width ;\n                    var y = i  * height - height/2;\n                    node.parent = this.mapLayer;\n                    node.x = x;\n                    node.y = y;\n\n                    cc.Atom.gameDataMgr.setData(\"brickWidth\" , width)\n                    cc.Atom.gameDataMgr.setData(\"brickHeight\", height)\n                }\n            }\n        }\n\n        //添加obj\n        var player = cc.Atom.prefabMgr.getPrefabObj(\"player_obj\"); //创建一个砖块 prefab节点\n        player.name   = \"player\"; \n        player.parent = this.mapLayer;\n        player.y = player.height/2 + player.height*3;\n        player.zIndex  = 100\n        this.player = player;\n\n        this.player_indexTag = Math.ceil(cc.Atom.gameConfMgr.getInfo(\"brickNum\")/2);\n        cc.Atom.gameDataMgr.setData(\"isPlayerMove\" , true);\n    },\n\n    update (dt) {\n        if(cc.Atom.gameState.isGameIng()){\n            this.mapController.mapUpdate(this.mapLayer , dt);\n        }\n    },\n});\n"]}